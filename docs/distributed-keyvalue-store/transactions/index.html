<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-distributed-keyvalue-store/transactions" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Transactions | Kahuna</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://kahunakv.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://kahunakv.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://kahunakv.github.io/docs/distributed-keyvalue-store/transactions"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Transactions | Kahuna"><meta data-rh="true" name="description" content="Overview"><meta data-rh="true" property="og:description" content="Overview"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://kahunakv.github.io/docs/distributed-keyvalue-store/transactions"><link data-rh="true" rel="alternate" href="https://kahunakv.github.io/docs/distributed-keyvalue-store/transactions" hreflang="en"><link data-rh="true" rel="alternate" href="https://kahunakv.github.io/docs/distributed-keyvalue-store/transactions" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Kahuna RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Kahuna Atom Feed"><link rel="stylesheet" href="/assets/css/styles.59f456b6.css">
<script src="/assets/js/runtime~main.beb8ee94.js" defer="defer"></script>
<script src="/assets/js/main.ff02435d.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Kahuna Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="Kahuna Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Kahuna</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Tutorial</a><a class="navbar__item navbar__link" href="/docs/getting-started">Documentation</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/kahunakv/kahuna" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/intro">Tutorials</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/getting-started">Getting Started</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/distributed-locks">Distributed Locks</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/distributed-keyvalue-store">Distributed Key/Value Store</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/distributed-keyvalue-store">Distributed Key/Value Store</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/distributed-keyvalue-store/cas">Compare-And-Swap (CAS)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/distributed-keyvalue-store/revisions">Revisions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/distributed-keyvalue-store/transactions">Transactions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/distributed-keyvalue-store/buckets">Key Distribution and Buckets</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/distributed-sequencer">Distributed Sequencer</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/scripts">Scripts</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/server-installation">Server</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/kahuna-cli">Client</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/architecture/overview">Architecture</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/storage/overview">Storage</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/recipes/rate-limiting">Recipes</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Distributed Key/Value Store</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Transactions</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Transactions</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h2>
<p>Kahuna offers <strong>distributed transactions</strong> to enable safe, consistent, and atomic access to keys across the cluster. Transactions ensure that multiple reads and writes either all succeed together or none take effect—making them essential for maintaining <strong>data correctness</strong> in concurrent and distributed environments.</p>
<p>Kahuna supports <strong>snapshot isolation</strong> and <strong>serializable consistency</strong> through <strong>MVCC (Multi-Version Concurrency Control)</strong> and <strong>optimistic/pessimistic locking</strong>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="why-transactions-matter">Why Transactions Matter?<a href="#why-transactions-matter" class="hash-link" aria-label="Direct link to Why Transactions Matter?" title="Direct link to Why Transactions Matter?">​</a></h2>
<p>In a distributed system, multiple clients might access and modify overlapping sets of keys. Without transactions, you risk:</p>
<ul>
<li><strong>Lost updates</strong> (e.g., one client overwriting another)</li>
<li><strong>Read skew</strong> (inconsistent reads during writes)</li>
<li><strong>Partial updates</strong> (only some keys being modified)</li>
</ul>
<p>Kahuna’s transactional engine addresses these issues by:</p>
<ul>
<li>Isolating reads and writes from each other using <strong>MVCC</strong> versions</li>
<li>Detecting write conflicts during commit</li>
<li>Optionally acquiring <strong>locks</strong> to serialize conflicting transactions</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="core-concepts">Core Concepts<a href="#core-concepts" class="hash-link" aria-label="Direct link to Core Concepts" title="Direct link to Core Concepts">​</a></h2>
<table><thead><tr><th>Concept</th><th>Description</th></tr></thead><tbody><tr><td><strong>Snapshot Isolation</strong></td><td>Readers see a consistent snapshot of the data as of the transaction start. Writers commit only if no conflicting writes occurred.</td></tr><tr><td><strong>Serializable Transactions</strong></td><td>Pessimistic locks can be used to enforce total ordering of transactions.</td></tr><tr><td><strong>MVCC</strong></td><td>Each key maintains multiple versions. Reads select the correct version based on transaction timestamp.</td></tr><tr><td><strong>Transaction Timestamp</strong></td><td>A <a href="/docs/architecture/hybrid-logical-clocks">Hybrid Logical Clock (HLC)</a> timestamp assigned at transaction start, used for snapshot reads and version tracking.</td></tr><tr><td><strong>Write Set</strong></td><td>The keys a transaction intends to modify.</td></tr><tr><td><strong>Read Set</strong></td><td>The keys a transaction read; used for conflict detection.</td></tr><tr><td><strong>Locks</strong></td><td>Optional. Acquired for pessimistic or serialized transactions. Locks have expiration to prevent being held forever.</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="transaction-api">Transaction API<a href="#transaction-api" class="hash-link" aria-label="Direct link to Transaction API" title="Direct link to Transaction API">​</a></h2>
<p>All operations in a Kahuna Script are implicitly part of a transaction:</p>
<div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">set </span><span class="token string-literal string" style="color:#e3116c">&quot;services/auth&quot;</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&quot;localhost:8081&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set </span><span class="token string-literal string" style="color:#e3116c">&quot;services/matchmaking&quot;</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&quot;localhost:8082&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set </span><span class="token string-literal string" style="color:#e3116c">&quot;services/inventory&quot;</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&quot;localhost:8083&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="basic-usage">Basic Usage<a href="#basic-usage" class="hash-link" aria-label="Direct link to Basic Usage" title="Direct link to Basic Usage">​</a></h3>
<div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> let current_alice </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> get </span><span class="token string-literal string" style="color:#e3116c">&quot;balance:alice&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> let current_bob </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> get </span><span class="token string-literal string" style="color:#e3116c">&quot;balance:alice&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> current_alice </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">50</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  set </span><span class="token string-literal string" style="color:#e3116c">&quot;balance:alice&quot;</span><span class="token plain"> current </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">50</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  set </span><span class="token string-literal string" style="color:#e3116c">&quot;balance:bob&quot;</span><span class="token plain"> current </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">50</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> commit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-conditional-write-based-on-a-snapshot">Example: Conditional Write Based on a Snapshot<a href="#example-conditional-write-based-on-a-snapshot" class="hash-link" aria-label="Direct link to Example: Conditional Write Based on a Snapshot" title="Direct link to Example: Conditional Write Based on a Snapshot">​</a></h3>
<div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> let config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> get </span><span class="token string-literal string" style="color:#e3116c">&quot;settings/feature-x&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> config </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&quot;enabled&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   set </span><span class="token string-literal string" style="color:#e3116c">&quot;logs/feature-x&quot;</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&quot;used&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> commit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Even if <code>feature-x</code> is disabled mid-transaction by another client, the snapshot ensures this transaction still sees the older version and behaves consistently.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="using-get-by-prefix-inside-a-transaction">Using <code>get by prefix</code> inside a Transaction<a href="#using-get-by-prefix-inside-a-transaction" class="hash-link" aria-label="Direct link to using-get-by-prefix-inside-a-transaction" title="Direct link to using-get-by-prefix-inside-a-transaction">​</a></h2>
<p>All keys in a given <strong>bucket prefix</strong> (e.g., <code>services/</code>) are guaranteed to be on the same partition. This enables <strong>prefix scans</strong> to be consistent and transactional:</p>
<div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> let services </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> get by prefix </span><span class="token string-literal string" style="color:#e3116c">&quot;services&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> contains</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">services</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&quot;services/users&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  set </span><span class="token string-literal string" style="color:#e3116c">&quot;services/users&quot;</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&quot;localhost:8084&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> commit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Learn more about buckets and keys distribution in the <a href="/docs/distributed-keyvalue-store/buckets">previous section</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="transaction-lifecycle">Transaction Lifecycle<a href="#transaction-lifecycle" class="hash-link" aria-label="Direct link to Transaction Lifecycle" title="Direct link to Transaction Lifecycle">​</a></h2>
<ol>
<li><strong>Begin</strong>: Kahuna assigns an HLC timestamp and starts tracking reads/writes. Locks are acquired in advance in pessimistic locking.</li>
<li><strong>Read/Write</strong>: All operations are buffered in-memory.</li>
<li><strong>Validation</strong>:<!-- -->
<ul>
<li>If optimistic: Check for conflicts with newer committed versions.</li>
<li>If pessimistic: Lock keys ahead of time to avoid conflicts.</li>
</ul>
</li>
<li><strong>Commit</strong>:<!-- -->
<ul>
<li>If successful, MVCC versions are written and optionally replicated (persistent mode).</li>
<li>If failed, changes are discarded and client is notified.</li>
</ul>
</li>
</ol>
<p>Learn more about transaction lifecycle in the <a href="/docs/architecture/distributed-transactions">architecture</a> section.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="durability-modes-in-transactions">Durability Modes in Transactions<a href="#durability-modes-in-transactions" class="hash-link" aria-label="Direct link to Durability Modes in Transactions" title="Direct link to Durability Modes in Transactions">​</a></h2>
<table><thead><tr><th>Mode</th><th>Behavior</th></tr></thead><tbody><tr><td><strong>Persistent</strong></td><td>Commits are replicated and flushed to disk using Raft. Strong durability guarantees.</td></tr><tr><td><strong>Ephemeral</strong></td><td>For lightweight, non-persistent use cases (e.g., caching, temporary locks). Faster but not durable.</td></tr></tbody></table>
<p>Example:</p>
<div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> eset </span><span class="token string-literal string" style="color:#e3116c">&quot;session:abc&quot;</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&quot;active&quot;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># session is stored in ephemeral durability (in-memory)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> set </span><span class="token string-literal string" style="color:#e3116c">&quot;session:xyz&quot;</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&quot;active&quot;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># session is stored in persistent durability (disk)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> commit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Learn more about durabilities in the <a href="/docs/architecture/durability-levels">dedicated section</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="best-practices">Best Practices<a href="#best-practices" class="hash-link" aria-label="Direct link to Best Practices" title="Direct link to Best Practices">​</a></h2>
<ul>
<li><strong>Group keys by prefix</strong> when designing schemas to maximize transactional locality.</li>
<li>Use <strong>ephemeral keys</strong> for high-speed, non-critical paths.</li>
<li>Consider <strong>pessimistic locking</strong> for highly contended keys to avoid retries.</li>
<li>Monitor retries to detect <strong>hotspots</strong> in your workload.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="transaction-options">Transaction Options<a href="#transaction-options" class="hash-link" aria-label="Direct link to Transaction Options" title="Direct link to Transaction Options">​</a></h2>
<p>You can specify <strong>transaction options</strong> to fine-tune how the transaction is executed. These options provide greater flexibility and control over <strong>performance</strong>, <strong>consistency</strong>, and <strong>responsiveness</strong>:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="timeout">Timeout<a href="#timeout" class="hash-link" aria-label="Direct link to Timeout" title="Direct link to Timeout">​</a></h3>
<p>Specifies the <strong>maximum duration (in milliseconds)</strong> that the transaction is allowed to run.
If the transaction does not complete within this time, it will be <strong>automatically rolled back</strong>.</p>
<ul>
<li>Kahuna Scripts are designed for <strong>short executions</strong>, so increasing this value significantly is <strong>not recommended</strong>.</li>
<li><strong>Default value:</strong> <code>5000ms</code></li>
</ul>
<div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">begin</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">timeout</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">3000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  set </span><span class="token command-literal command string" style="color:#e3116c">`config1`</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&#x27;some value 1&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  set </span><span class="token command-literal command string" style="color:#e3116c">`config2`</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&#x27;some value 2&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  set </span><span class="token command-literal command string" style="color:#e3116c">`config3`</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&#x27;some value 3&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  commit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="locking">Locking<a href="#locking" class="hash-link" aria-label="Direct link to Locking" title="Direct link to Locking">​</a></h3>
<p>Defines the <strong>locking strategy</strong> used by the transaction.</p>
<ul>
<li>
<p><code>pessimistic</code>: Locks keys upfront to ensure full consistency.</p>
</li>
<li>
<p><code>optimistic</code>: Locks only on write, with version validation during commit.</p>
</li>
<li>
<p><strong>Default value:</strong> <code>pessimistic</code></p>
</li>
</ul>
<div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">begin</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">locking</span><span class="token operator" style="color:#393A34">=</span><span class="token string-literal string" style="color:#e3116c">&quot;optimistic&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  set </span><span class="token command-literal command string" style="color:#e3116c">`config1`</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&#x27;some value 1&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  set </span><span class="token command-literal command string" style="color:#e3116c">`config2`</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&#x27;some value 2&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  set </span><span class="token command-literal command string" style="color:#e3116c">`config3`</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&#x27;some value 3&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  commit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="asyncrelease">AsyncRelease<a href="#asyncrelease" class="hash-link" aria-label="Direct link to AsyncRelease" title="Direct link to AsyncRelease">​</a></h3>
<p>Indicates whether acquired locks should be <strong>released asynchronously</strong> (in the background) or <strong>synchronously</strong> (blocking the client until fully released).</p>
<ul>
<li>
<p><code>true</code>: Faster response to the client, locks released in background.</p>
</li>
<li>
<p><code>false</code>: Locks must be released before returning to the client.</p>
</li>
<li>
<p><strong>Default value:</strong> <code>false</code></p>
</li>
</ul>
<div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">begin</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">asyncRelease</span><span class="token operator" style="color:#393A34">=</span><span class="token string-literal string" style="color:#e3116c">&quot;true&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  set </span><span class="token command-literal command string" style="color:#e3116c">`config1`</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&#x27;some value 1&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  set </span><span class="token command-literal command string" style="color:#e3116c">`config2`</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&#x27;some value 2&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  set </span><span class="token command-literal command string" style="color:#e3116c">`config3`</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&#x27;some value 3&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  commit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="autocommit">AutoCommit<a href="#autocommit" class="hash-link" aria-label="Direct link to AutoCommit" title="Direct link to AutoCommit">​</a></h3>
<p>Specifies whether an <strong>implicit <code>commit</code></strong> should be executed automatically if all operations in the transaction succeed, or if an <strong>explicit <code>commit</code></strong> is required to finalize the transaction.</p>
<ul>
<li>
<p><code>true</code>: The transaction will <strong>automatically commit</strong> if no errors occur.</p>
</li>
<li>
<p><code>false</code>: A manual <code>commit()</code> is required to indicate when the transaction should be finalized.</p>
</li>
<li>
<p><strong>Default behavior:</strong></p>
<ul>
<li><code>false</code> when using a <code>begin</code> block</li>
<li><code>true</code> when no <code>begin</code> block is used</li>
</ul>
</li>
</ul>
<p><strong>Example:</strong></p>
<div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">begin</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">autoCommit</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  commit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="interactive-transactions">Interactive Transactions<a href="#interactive-transactions" class="hash-link" aria-label="Direct link to Interactive Transactions" title="Direct link to Interactive Transactions">​</a></h2>
<p>Interactive transactions are an option for developers who prefer not to use Kahuna Scripts and instead want access to the libraries and functions of their favorite programming language.</p>
<p>These transactions work similarly to traditional database transactions, where the client must manually start a transaction and then commit or rollback it as needed, depending on the outcome:</p>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">C#</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><p>The Kahuna client for C# offers full support for interactive transactions.</p><p>This allows developers to start, manage, and complete transactions directly from their C# applications, giving them fine-grained control over the flow of operations while maintaining strong consistency guarantees provided by Kahuna:</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">using</span><span class="token plain"> </span><span class="token class-name">KahunaTransactionSession</span><span class="token plain"> session </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">StartTransactionSession</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">new</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Locking </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> KeyValueTransactionLocking</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Optimistic</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Timeout </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token class-name">KahunaKeyValue</span><span class="token plain"> balance1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> session</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetKeyValue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">keyNameA</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token class-name">KahunaKeyValue</span><span class="token plain"> balance2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> session</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetKeyValue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">keyNameB</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Parse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">balance1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ValueAsString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">??</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;0&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Parse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">balance2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ValueAsString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">??</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;0&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> session</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">SetKeyValue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">keyNameA</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;0&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> session2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Commit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div>
<p>This approach gives developers more flexibility to build complex logic in the application layer while still benefiting from Kahuna’s consistency and durability guarantees.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="interactive-transactions-vs-kahuna-scripts">Interactive Transactions vs Kahuna Scripts<a href="#interactive-transactions-vs-kahuna-scripts" class="hash-link" aria-label="Direct link to Interactive Transactions vs Kahuna Scripts" title="Direct link to Interactive Transactions vs Kahuna Scripts">​</a></h2>
<p>Both Interactive Transactions and Kahuna Scripts offer powerful ways to work with Kahuna’s distributed system, each with distinct trade-offs.
Interactive Transactions provide greater flexibility and ease of integration with application code but at the cost of higher network latency and complexity in failure scenarios.</p>
<p>Kahuna Scripts, on the other hand, deliver atomicity, reduced latency, and automatic lock management, making them ideal for critical operations that need to execute entirely on the server — although they require familiarity with a specialized scripting environment.</p>
<p>Choosing between the two approaches depends on the specific needs of your application, the complexity of your logic, and your tolerance for latency versus maintenance effort:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="interactive-transactions-1">Interactive Transactions<a href="#interactive-transactions-1" class="hash-link" aria-label="Direct link to Interactive Transactions" title="Direct link to Interactive Transactions">​</a></h3>
<p><strong>Advantages</strong></p>
<ul>
<li><strong>Familiarity and Easier Debugging</strong>: You write the logic in your primary programming language (C#, JavaScript, etc.), making it easier to debug, maintain, and integrate with your development tools.</li>
<li><strong>Better Integration</strong>: Interactive transactions work seamlessly with application-level logic, error handling, and native data structures.</li>
</ul>
<p><strong>Disadvantages</strong></p>
<ul>
<li><strong>Increased Latency</strong>: Requires multiple round-trips between the client and server, which can introduce additional delays.</li>
<li><strong>Graceful Degradation Challenges</strong>: In the event of partial failures (e.g., network partitions), the client may be unable to manually commit or roll back transactions. Locks could be held until the transaction times out. This can be mitigated by setting short transaction timeouts (a few seconds).</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="kahuna-scripts">Kahuna Scripts<a href="#kahuna-scripts" class="hash-link" aria-label="Direct link to Kahuna Scripts" title="Direct link to Kahuna Scripts">​</a></h3>
<p><strong>Advantages</strong></p>
<ul>
<li><strong>Atomic Execution</strong>: The entire script executes atomically on the server (transaction coordinator), as long as there are no node failures or abnormal inter-node network conditions.</li>
<li><strong>Automatic Lock Management</strong>: Kahuna Scripts automatically release acquired locks in the presence of conflicts, reducing complexity and avoiding unwanted delays or retries.</li>
<li><strong>Supports Complex Logic</strong>: Scripts can include conditionals (<code>if</code>, <code>while</code>, etc.), loops, functions, and branching logic directly on the server.</li>
<li><strong>Shared and Portable Logic</strong>: The same Kahuna Script can be executed from multiple programming languages without modification or extra maintenance.</li>
<li><strong>Reduced Round-Trips</strong>: Operations are fully executed server-side, minimizing network latency between client and server.</li>
</ul>
<p><strong>Disadvantages</strong></p>
<ul>
<li><strong>Potentially Harder to Maintain</strong>: Kahuna Script syntax may be less familiar and harder to debug or test compared to your main programming language.</li>
<li><strong>Script Size Limitations</strong>: Large or complex business logic may be difficult to express and maintain within Kahuna Scripts.</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/kahunakv/kahunakv.github.io/tree/main/docs/distributed-keyvalue-store/transactions.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/distributed-keyvalue-store/revisions"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Revisions</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/distributed-keyvalue-store/buckets"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Key Distribution and Buckets</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#why-transactions-matter" class="table-of-contents__link toc-highlight">Why Transactions Matter?</a></li><li><a href="#core-concepts" class="table-of-contents__link toc-highlight">Core Concepts</a></li><li><a href="#transaction-api" class="table-of-contents__link toc-highlight">Transaction API</a><ul><li><a href="#basic-usage" class="table-of-contents__link toc-highlight">Basic Usage</a></li><li><a href="#example-conditional-write-based-on-a-snapshot" class="table-of-contents__link toc-highlight">Example: Conditional Write Based on a Snapshot</a></li></ul></li><li><a href="#using-get-by-prefix-inside-a-transaction" class="table-of-contents__link toc-highlight">Using <code>get by prefix</code> inside a Transaction</a></li><li><a href="#transaction-lifecycle" class="table-of-contents__link toc-highlight">Transaction Lifecycle</a></li><li><a href="#durability-modes-in-transactions" class="table-of-contents__link toc-highlight">Durability Modes in Transactions</a></li><li><a href="#best-practices" class="table-of-contents__link toc-highlight">Best Practices</a></li><li><a href="#transaction-options" class="table-of-contents__link toc-highlight">Transaction Options</a><ul><li><a href="#timeout" class="table-of-contents__link toc-highlight">Timeout</a></li><li><a href="#locking" class="table-of-contents__link toc-highlight">Locking</a></li><li><a href="#asyncrelease" class="table-of-contents__link toc-highlight">AsyncRelease</a></li><li><a href="#autocommit" class="table-of-contents__link toc-highlight">AutoCommit</a></li></ul></li><li><a href="#interactive-transactions" class="table-of-contents__link toc-highlight">Interactive Transactions</a></li><li><a href="#interactive-transactions-vs-kahuna-scripts" class="table-of-contents__link toc-highlight">Interactive Transactions vs Kahuna Scripts</a><ul><li><a href="#interactive-transactions-1" class="table-of-contents__link toc-highlight">Interactive Transactions</a></li><li><a href="#kahuna-scripts" class="table-of-contents__link toc-highlight">Kahuna Scripts</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Tutorials</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/architecture/overview">Architecture</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/recipes/rate-limiting">Recipes</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/kahunakv/kahuna/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/kahunakv/kahuna" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Kahuna.</div></div></div></footer></div>
</body>
</html>